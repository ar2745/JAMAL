# Message Model

## Overview
The Message model represents a single message in the chat system. It supports different types of messages including text messages, web search results, and LLM-generated responses. The model is part of our service-based architecture and integrates with the LLM service for enhanced response generation.

## Schema
```typescript
interface Message {
  id: string;
  role: "user" | "assistant";
  content: string;
  type: "text" | "web_search" | "llm_response";
  timestamp: string;
  conversation_id: string;
  metadata?: {
    isWebSearch?: boolean;
    searchResults?: Array<{
      title: string;
      url: string;
      snippet: string;
    }>;
    llm_metadata?: {
      model_type: "SIMPLE" | "REASONED";
      temperature: number;
      max_tokens: number;
      processing_time: number;
      confidence_score: number;
    };
  };
}
```

## Fields
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| id | string | Yes | Unique identifier for the message |
| role | "user" \| "assistant" | Yes | Sender of the message |
| content | string | Yes | The message content |
| type | "text" \| "web_search" \| "llm_response" | Yes | Type of message |
| timestamp | string | Yes | ISO timestamp of when the message was sent |
| conversation_id | string | Yes | ID of the conversation this message belongs to |
| metadata | object | No | Additional message metadata |

### Metadata Fields
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| isWebSearch | boolean | No | Indicates if this is a web search message |
| searchResults | Array<SearchResult> | No | Results from web search |
| llm_metadata | object | No | LLM-specific metadata |

### LLM Metadata Fields
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| model_type | "SIMPLE" \| "REASONED" | No | Type of LLM used |
| temperature | number | No | Temperature setting used |
| max_tokens | number | No | Maximum tokens generated |
| processing_time | number | No | Time taken to generate response |
| confidence_score | number | No | Model's confidence in response |

### SearchResult Type
```typescript
interface SearchResult {
  title: string;
  url: string;
  snippet: string;
}
```

## Relationships
- Messages are associated with a Chat
- Messages can reference Documents and Links through context
- Messages can include web search results
- Messages can be generated by the LLM service
- Messages maintain conversation history through conversation_id

## Validation Rules
1. `id` must be unique
2. `role` must be either "user" or "assistant"
3. `type` must be either "text", "web_search", or "llm_response"
4. `timestamp` must be a valid ISO string
5. `conversation_id` must be present
6. If `type` is "web_search", `metadata.searchResults` must be present
7. If `type` is "llm_response", `metadata.llm_metadata` must be present

## Usage Examples
```typescript
// Example 1: Regular text message
const message: Message = {
  id: "123456789",
  role: "user",
  content: "Hello, how are you?",
  type: "text",
  timestamp: "2024-04-13T21:30:00.000Z",
  conversation_id: "conv_123"
};

// Example 2: Web search message
const webSearchMessage: Message = {
  id: "987654321",
  role: "assistant",
  content: "Here are the search results for your query:",
  type: "web_search",
  timestamp: "2024-04-13T21:31:00.000Z",
  conversation_id: "conv_123",
  metadata: {
    isWebSearch: true,
    searchResults: [
      {
        title: "Latest AI Developments",
        url: "https://example.com/ai-news",
        snippet: "Recent breakthroughs in AI technology..."
      }
    ]
  }
};

// Example 3: LLM-generated response
const llmMessage: Message = {
  id: "456789123",
  role: "assistant",
  content: "I'm doing well, thank you for asking!",
  type: "llm_response",
  timestamp: "2024-04-13T21:32:00.000Z",
  conversation_id: "conv_123",
  metadata: {
    llm_metadata: {
      model_type: "SIMPLE",
      temperature: 0.7,
      max_tokens: 150,
      processing_time: 0.5,
      confidence_score: 0.95
    }
  }
};
```

## Notes
- Messages are immutable once created
- Web search messages include both the response and search results
- LLM-generated messages include model configuration and performance metrics
- Timestamps are stored in ISO format for consistency
- The model supports extensibility through the metadata field
- Conversation history is maintained through conversation_id
- Messages can be streamed when using the LLM service 